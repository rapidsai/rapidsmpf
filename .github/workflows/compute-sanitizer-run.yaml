name: Compute Sanitizer Run

on:
  workflow_call:
    inputs:
      tool_name:
        required: true
        type: string
        description: "Compute sanitizer tool to run (memcheck, racecheck, initcheck, synccheck)"
  workflow_dispatch:
    inputs:
      tool_name:
        required: true
        type: choice
        description: "Compute sanitizer tool to run"
        options:
          - memcheck
          - racecheck
          - initcheck
          - synccheck

jobs:
  run-sanitizer-tests:
    name: Run ${{ inputs.tool_name }} on single_tests
    runs-on: linux-amd64-gpu-l4-latest-1
    container:
      image: rapidsai/ci-conda:26.02-latest
      options: --gpus all
    continue-on-error: true
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Run compute-sanitizer ${{ inputs.tool_name }} on single_tests
        shell: bash
        env:
          TOOL_NAME: "${{ inputs.tool_name }}"
        run: |
          ./ci/test_cpp_sanitizer.sh "${TOOL_NAME}" single_tests
